import{d as ne,J as j,r as D,ac as ce,y as de,g as re,a5 as O,o as h,c as p,a as e,b as u,u as o,h as r,t as f,w as m,i as I,p as A,k as v,n as V,F as ue,j as he,e as N,v as P,s as me,x as _e,_ as pe}from"./index-039f4073.js";import{_ as ve}from"./icon_note-96b9c260.js";import{u as xe,D as fe,_ as ge,a as ke,b as be,c as U,d as we}from"./DraggableTable-1ef0d209.js";import{_ as Ce}from"./icon_search_white-67c4c154.js";import{_ as L}from"./icon_outcome-1d2e6907.js";import{I as g}from"./createPageStore-69190bd9.js";import{u as Se,_ as ye}from"./AddEditRulesForm.vue_vue_type_script_setup_true_lang-c8949d6b.js";import{_ as z}from"./InputDate.vue_vue_type_style_index_0_lang-1e3be0af.js";import{N as w}from"./Checkbox-2c7dea10.js";import{T as Te}from"./Table-40d47b03.js";import{D as De}from"./vuedraggable.umd-89278f99.js";import"./FormTitle.vue_vue_type_script_setup_true_lang-31e68bf9.js";import"./moment-fbc5633a.js";import"./vue.runtime.esm-bundler-8ba684d5.js";const n=y=>(me("data-v-e99436a4"),y=y(),_e(),y),Ie={class:"text-neutral-800"},Re=n(()=>e("div",{class:"max-w-[1315px] mx-auto mb-12"},[e("h1",{class:"text-[32px]"}," 規則管理 ")],-1)),Ae={class:"max-w-[1315px] mx-auto mb-8"},Ee={class:"search mb-10"},$e=n(()=>e("h2",{class:"flex items-center mb-6 font-semibold"},[e("img",{class:"mr-2",src:ve,alt:"Search Page"}),r(" 搜尋網頁 ")],-1)),Fe={class:"rounded-[16px] overflow-hidden border border-[#B9B9B9]"},Be=n(()=>e("h3",{class:"text-sm font-bold text-primary-600 bg-[#E6EDF3] py-4 px-6 border border-b-[#80B7DE]"}," 請輸入搜尋條件(擇一) ",-1)),Me={class:"bg-white flex flex-col max-[1065px]:flex-row px-[24px] pb-[20px] pt-[120px]"},je={class:"flex flex-col absolute top-[270px]"},Oe=n(()=>e("label",{class:"mb-[10px]"}," 發佈時間 ",-1)),Ve={class:"flex"},Ne=n(()=>e("div",{class:"flex items-center justify-center px-[10px] ml-[55px]"}," - ",-1)),Pe={class:"flex items-center max-[1065px]:flex-col max-[1065px]:items-start"},ze=n(()=>e("p",{class:"flex items-center mr-4 max-[1065px]:mb-[5px] max-[1065px]:mt-[3px]"},[e("img",{class:"mr-2",src:ge,alt:"Status"}),r(" 狀態 ")],-1)),Ue={class:"flex max-[1065px]:flex-col max-[1065px]:mb-[20px] max-[1065px]:gap-1"},Le={class:"ml-1 mr-5 max-[1065px]:ml-0"},We={for:"published",class:"flex items-center"},He={class:"mr-5"},Qe={for:"pending",class:"flex items-center"},qe={class:"mr-5"},Ge={class:"flex items-center"},Je={class:"mr-5"},Ye={class:"flex items-center"},Ke={class:"mr-5"},Xe={class:"flex items-center"},Ze={class:"flex items-center"},et={class:"ml-auto flex gap-3"},tt=n(()=>e("img",{class:"mr-4",src:Ce,alt:"Search"},null,-1)),st={class:"search mb-10"},at={class:"search-outcome flex items-center justify-between mb-8"},lt=n(()=>e("h2",{class:"flex items-center font-semibold"},[e("img",{class:"mr-2",src:L,alt:"Query"}),r(" 查詢結果 ")],-1)),it=n(()=>e("img",{class:"mr-2",src:ke,alt:"Add"},null,-1)),ot=n(()=>e("caption",null,"Rules Management Table",-1)),nt=n(()=>e("th",{class:"flex ml-3 justify-start w-[35%]"}," 規則名稱 ",-1)),ct=n(()=>e("th",{class:"w-[12%]"}," 狀態 ",-1)),dt=n(()=>e("th",{class:"w-[15%]"}," 發佈時間 ",-1)),rt={key:0,class:"grow"},ut={class:"w-[35%]","data-title":"Rule 題目："},ht={class:"flex items-center pl-3 max-[1065px]:pl-3"},mt={class:"w-[12%]","data-title":"狀態："},_t={class:"flex items-center pl-3 max-[1065px]:pl-3"},pt={src:be,alt:"Waiting For Release"},vt={src:U,alt:"Announcing"},xt={class:"ml-2"},ft={class:"w-[15%]","data-title":"發佈時間："},gt={class:"max-[1065px]:pl-3"},kt={class:"grid grid-cols-3 max-[1065px]:pl-3"},bt=["onClick"],wt=["onClick"],Ct=["onClick"],St=["onClick"],yt={key:0,class:"grow","data-title":"審核："},Tt={class:"flex gap-[10px] justify-center"},Dt=n(()=>e("div",{class:"search-outcome flex items-center justify-between mb-8"},[e("h2",{class:"flex items-center font-semibold"},[e("img",{class:"mr-2",src:L,alt:"Arrangement"}),r(" 排列順序 ")])],-1)),It=n(()=>e("th",{class:"flex ml-3 justify-start w-[35%]"}," 規則名稱 ",-1)),Rt=n(()=>e("th",{class:"w-[12%]"}," 狀態 ",-1)),At=n(()=>e("th",{class:"w-[15%]"}," 發佈時間 ",-1)),Et=n(()=>e("th",{class:"grow"}," 編號 ",-1)),$t={class:"tr list-group-item text-center text-sm text-black"},Ft={class:"w-[35%] max-[1065px]:ml-7","data-title":"Rule 題目："},Bt={class:"flex items-center max-[1065px]:pl-3"},Mt=n(()=>e("img",{class:"mr-5 max-[1065px]:hidden",src:we,alt:"Catch"},null,-1)),jt={class:"w-[12%] max-[1065px]:ml-7","data-title":"狀態："},Ot={class:"flex items-center pl-3 max-[1065px]:pl-3"},Vt=n(()=>e("img",{src:U,alt:"Check"},null,-1)),Nt={class:"ml-2"},Pt={class:"w-[15%] max-[1065px]:ml-7","data-title":"發佈時間："},zt={class:"max-[1065px]:pl-3"},Ut={class:"max-[1065px]:ml-7","data-title":"操作："},Lt={class:"max-[1065px]:pl-3"},Wt=ne({__name:"RulesManagement",setup(y){const W=Se(),{rulesManagementInfo:_,filterRulesData:k,permissionStatus:x,filterSelectDate:d,checkBoxState:s,sortOrderRulesData:H}=j(W),E=D(H.value),R=D(""),T=D("backAdd"),C=D(!1),Q=ce();de(()=>Q.path);function q(){x.value==="review"?(s.value.discontinued.isChecked=!0,s.value.pending.isChecked=!0,s.value.published.isChecked=!0,s.value.reviewing.isChecked=!0,s.value.reviewFailed.isChecked=!0,s.value.editing.isChecked=!0,x.value=""):(s.value.discontinued.isChecked=!1,s.value.pending.isChecked=!1,s.value.published.isChecked=!1,s.value.reviewing.isChecked=!0,s.value.reviewFailed.isChecked=!1,s.value.editing.isChecked=!1,x.value="review")}re(()=>{s.value.discontinued.isChecked=!0,s.value.pending.isChecked=!0,s.value.published.isChecked=!0,s.value.reviewing.isChecked=!0,s.value.reviewFailed.isChecked=!0,s.value.editing.isChecked=!0,k.value=_.value});const G=()=>{const l=Object.keys(s.value).some(c=>s.value[c].isChecked),a=d.value.searchStartTime!="",t=d.value.searchEndTime!="";if(l)l&&a&&t?k.value=_.value.filter(c=>{const i=new Date(c.publishStartAt),S=(!d.value.searchStartTime||i>=new Date(d.value.searchStartTime))&&(!d.value.searchEndTime||i<=new Date(d.value.searchEndTime));return Object.keys(s.value).some(oe=>{const M=s.value[oe];return M.isChecked&&c.status===M.value&&S})}):l&&a||t?alert("請選擇發佈起始時間和截止時間"):k.value=_.value.filter(c=>Object.keys(s.value).some(i=>{const S=s.value[i];return S.isChecked&&c.status===S.value}));else if(a&&t)k.value=_.value.filter(c=>{const i=new Date(c.publishStartAt);return(!d.value.searchStartTime||i>=new Date(d.value.searchStartTime))&&(!d.value.searchEndTime||i<=new Date(d.value.searchEndTime))});else if(a||t)alert("請選擇發佈起始時間和截止時間");else return k.value=[]};function J(l){console.log("startPublishStartAt:"),console.log(l);const t=new Date(l).toISOString().split("T")[0];d.value.searchStartTime=t,console.log(d.value.searchStartTime)}function Y(l){console.log("endPublishStartAt:"),console.log(l);const a=new Date(l);a.setHours(23,59,59,999);const t=a.toISOString().split("T")[0];d.value.searchEndTime=t,console.log(d.value.searchEndTime)}function b(l){s.value[l].isChecked=!s.value[l].isChecked}function $(l){const a=new Date(l),t=a.getFullYear(),c=(a.getMonth()+1).toString().padStart(2,"0"),i=a.getDate().toString().padStart(2,"0");return`${t}/${c}/${i}`}function K(){T.value="backAdd",C.value=!0}function X(l){const a=_.value.findIndex(t=>t.ruleId===l);console.log(a),a!==-1&&_.value.splice(a,1)}function Z(l){T.value="backQuery",R.value=l,C.value=!0}function ee(l){T.value="backEdit",console.log(l),R.value=l,C.value=!0}function te(l){l.status=g.Suspended}function se(){C.value=!1}function F(l,a,t){const c=t.value.findIndex(i=>i.ruleId===l.ruleId);if(c!==-1){const i=l;i.publishStartAt=$(i.publishStartAt),i.publishEndAt=$(i.publishEndAt),i.status=a,t.value[c]=i}}function ae(l,a){switch(console.log("獲得了"),console.log(l),console.log(a),a){case"backAdd":_.value.push(l);break;case"backEdit":F(l,g.InReview,_);break;case"backEditing":F(l,g.Editing,_);break}}const le=xe(),{breadcrumbs:ie}=j(le);ie.value=[{title:"資料",path:O.DATA_MAINTENANCE},{title:"規則管理",path:O.RULES}];function B(l,a){l.status=a}return(l,a)=>(h(),p("section",Ie,[Re,e("div",Ae,[e("div",Ee,[$e,e("div",Fe,[Be,e("div",Me,[e("div",je,[Oe,e("div",Ve,[u(z,{placeholder:"請選擇日期",class:"date-picker-input","onUpdate:modelValue":J}),Ne,u(z,{placeholder:"請選擇日期",class:"date-picker-input","onUpdate:modelValue":Y})])]),e("div",Pe,[ze,e("ul",Ue,[e("li",Le,[e("label",We,[u(w,{id:"published",name:"state","model-value":o(s).published.isChecked,"is-checked":o(s).published.isChecked,onChange:a[0]||(a[0]=t=>b("published"))},null,8,["model-value","is-checked"]),r(" 發佈中 ")])]),e("li",He,[e("label",Qe,[u(w,{id:"pending",name:"state","model-value":o(s).pending.isChecked,"is-checked":o(s).pending.isChecked,onChange:a[1]||(a[1]=t=>b("pending"))},null,8,["model-value","is-checked"]),r(" 等待發佈 ")])]),e("li",qe,[e("label",Ge,[u(w,{id:"discontinued",name:"state","model-value":o(s).discontinued.isChecked,"is-checked":o(s).discontinued.isChecked,onChange:a[2]||(a[2]=t=>b("discontinued"))},null,8,["model-value","is-checked"]),r(" 下架 ")])]),e("li",Je,[e("label",Ye,[u(w,{id:"reviewing",name:"state","model-value":o(s).reviewing.isChecked,"is-checked":o(s).reviewing.isChecked,onChange:a[3]||(a[3]=t=>b("reviewing"))},null,8,["model-value","is-checked"]),r(" 審核中 ")])]),e("li",Ke,[e("label",Xe,[u(w,{id:"reviewFailed",name:"state","model-value":o(s).reviewFailed.isChecked,"is-checked":o(s).reviewFailed.isChecked,onChange:a[4]||(a[4]=t=>b("reviewFailed"))},null,8,["model-value","is-checked"]),r(" 審核失敗 ")])]),e("li",null,[e("label",Ze,[u(w,{id:"editing",name:"state","model-value":o(s).editing.isChecked,"is-checked":o(s).editing.isChecked,onChange:a[5]||(a[5]=t=>b("editing"))},null,8,["model-value","is-checked"]),r(" 編輯中 ")])])]),e("div",et,[e("button",{class:"bg-danger hover:bg-[#ba3e3e] text-[white] px-4 p-2 rounded-md ml-3 max-[1065px]:ml-0 text-sm",onClick:q},f(o(x)==="review"?"長官身份: 切換完請按搜尋":"員工身份: 切換完請按搜尋"),1),u(I,{class:"flex items-center justify-center font-semibold text-base pe-2",size:"custom",width:130,height:40,onClick:G},{default:m(()=>[tt,r(" 搜尋 ")]),_:1})])])])])]),e("div",st,[e("div",at,[lt,u(I,{class:"flex items-center justify-center font-semibold text-base",size:"custom",width:140,height:40,onClick:K},{default:m(()=>[it,r(" 新增規則 ")]),_:1})]),u(Te,null,{th:m(()=>[nt,ct,dt,e("th",{class:V(o(x)==="review"?"w-[18%]":"grow")}," 操作 ",2),o(x)==="review"?(h(),p("th",rt," 審核 ")):v("",!0)]),tobodyTr:m(()=>[(h(!0),p(ue,null,he(o(k),(t,c)=>(h(),p("tr",{key:c,class:"text-center text-sm text-black"},[e("td",ut,[e("div",ht,[e("span",null,f(t.ruleTitle),1)])]),e("td",mt,[e("div",_t,[N(e("img",pt,null,512),[[P,t.status!=="發佈中"&&t.status!=="等待發佈"]]),N(e("img",vt,null,512),[[P,t.status==="發佈中"||t.status==="等待發佈"]]),e("span",xt,f(t.status),1)])]),e("td",ft,[e("span",gt,f(t.publishStartAt),1)]),e("td",{class:V(o(x)==="review"?"w-[18%]":"grow"),"data-title":"操作："},[e("div",kt,[t.status!=="編輯中"?(h(),p("a",{key:0,class:"text-[#1170C0] underline cursor-pointer",onClick:i=>Z(t.ruleId)}," 查看內容 ",8,bt)):v("",!0),t.status==="下架"||t.status==="審核失敗"||t.status==="審核中"||t.status==="等待發佈"||t.status==="編輯中"?(h(),p("a",{key:1,class:"text-[#1170C0] underline cursor-pointer",onClick:i=>ee(t.ruleId)}," 編輯 ",8,wt)):v("",!0),t.status==="發佈中"?(h(),p("a",{key:2,class:"text-[#1170C0] underline cursor-pointer",onClick:i=>te(t)}," 下架 ",8,Ct)):v("",!0),t.status!=="發佈中"&&t.status!=="等待發佈"&&t.status!=="審核中"?(h(),p("a",{key:3,class:"text-[#1170C0] underline cursor-pointer",onClick:i=>X(t.ruleId)}," 刪除 ",8,St)):v("",!0)])],2),o(x)==="review"?(h(),p("td",yt,[e("div",Tt,[t.status===o(g).InReview?(h(),A(I,{key:0,size:"custom",width:70,height:40,onClick:i=>B(t,o(g).Published)},{default:m(()=>[r(" 通過 ")]),_:2},1032,["onClick"])):v("",!0),t.status===o(g).InReview?(h(),A(I,{key:1,class:"deny-button text-white font-bold py-2 px-4 rounded",size:"custom",width:70,height:40,onClick:i=>B(t,o(g).Failure)},{default:m(()=>[r(" 駁回 ")]),_:2},1032,["onClick"])):v("",!0)])])):v("",!0)]))),128))]),default:m(()=>[ot]),_:1})]),e("div",null,[Dt,u(fe,null,{th:m(()=>[It,Rt,At,Et]),tobodyTr:m(()=>[u(o(De),{modelValue:E.value,"onUpdate:modelValue":a[6]||(a[6]=t=>E.value=t),group:"sortOrderDataDisplay","drag-class":"drag","ghost-class":"ghost","item-key":"id",tag:"tbody","component-data":{tag:"tr",name:"flip-list",type:"transition"}},{item:m(({element:t,index:c})=>[e("tr",$t,[e("td",Ft,[e("div",Bt,[Mt,e("span",null,f(t.ruleTitle),1)])]),e("td",jt,[e("div",Ot,[Vt,e("span",Nt,f(t.status),1)])]),e("td",Pt,[e("div",zt,f(t.publishStartAt),1)]),e("td",Ut,[e("div",Lt,f(c+1)+". ",1)])])]),_:1},8,["modelValue"])]),_:1})])]),C.value?(h(),A(ye,{key:0,"rule-type":T.value,"edit-id":R.value,onClose:se,onAddOrEditRule:ae},null,8,["rule-type","edit-id"])):v("",!0)]))}});const is=pe(Wt,[["__scopeId","data-v-e99436a4"]]);export{is as default};
